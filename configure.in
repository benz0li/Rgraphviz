dnl configure.in for Rgraph, patterned on configure.in for rhdf5
dnl Process this file with autoconf to produce a configure script.
AC_INIT
AC_PREREQ(2.52)
AC_REVISION($Revision: 1.4 $)
AC_CONFIG_SRCDIR(src/Rgraphviz.c)

AC_DEFUN([CHECK_GRAPHVIZ],
[AC_MSG_CHECKING(for graphviz)
AC_ARG_WITH(graphviz,
[ --with-graphviz=DIR root directory of graphviz installation [defaults to
	/usr/local or /usr if not found in /usr/local and finally /scratch]],
[if test x"$withval" != no ; then
	AC_MSG_RESULT(yes)
	GRAPHVIZ_HOME="$withval"
else
	AC_MSG_RESULT(no)
fi],[
	AC_MSG_RESULT(yes)
	GRAPHVIZ_HOME="/usr/local"
	if test ! -f "${GRAPHVIZ_HOME}/include/graphviz/graph.h"
	then
		GRAPHVIZ_HOME="/usr"
		if test ! -f "${GRAPHVIZ_HOME}/include/graphviz/graph.h"
		then
			GRAPHVIZ_HOME="/scratch/"
		fi
	fi
])

if test -n "${GRAPHVIZ_HOME}"
then
	GRAPHVIZ_OLD_LDFLAGS=$LDFLAGS
	GRAPHVIZ_OLD_CPPFLAGS=$CPPFLAGS
	LDFLAGS="$LDFLAGS -L${GRAPHVIZ_HOME}/lib/graphviz"
	CPPFLAGS="$CPPFLAGS -I${GRAPHVIZ_HOME}/include/graphviz"
	AC_LANG_SAVE
	AC_LANG_C
	AC_CHECK_LIB(graph,agopen,[graphviz_cv_libgraph=yes],[graphviz_cv_libgraph=no], -lcdt)
	AC_CHECK_HEADER(graph.h,[graphviz_cv_graph_h=yes],[graphviz_cv_graph_h=no])
	AC_LANG_RESTORE
	if test "$graphviz_cv_libgraph" = "yes" -a "$graphviz_cv_graph_h" = "yes"
	then
		AC_MSG_CHECKING(graphviz in ${GRAPHVIZ_HOME})
		PKG_LIBS="${PKG_LIBS} -L${GRAPHVIZ_HOME}/lib/graphviz -lgraph -ldot -lneato -lpack -ldotneato -lpathplan -lcdt -lm -ljpeg -lpng -lfreetype -lz"
		PKG_CPPFLAGS="${PKG_CPPFLAGS} -I${GRAPHVIZ_HOME}/include/graphviz"
		AC_MSG_RESULT(ok)
	else
		AC_MSG_CHECKING(graphviz in ${GRAPHVIZ_HOME})
		LDFLAGS="${GRAPHVIZ_OLD_LDFLAGS}"
		CPPFLAGS="${GRAPHVIZ_OLD_CPPFLAGS}"
		AC_MSG_RESULT(failed)
		AC_MSG_ERROR(please specify a valid graphviz installation with --with-graphviz=DIR)
	fi
fi])


CHECK_GRAPHVIZ
AC_SUBST(PKG_CPPFLAGS)
AC_SUBST(PKG_LIBS)
AC_OUTPUT(src/Makevars)
